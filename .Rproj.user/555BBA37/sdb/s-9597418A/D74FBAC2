{
    "contents" : "# Find and subset practitioners from user input\nlibrary(fields)\n\n# test data\n#zip <- \"77054\"\n#radius <- 5 # miles\n#check = \"AGENT\"\n\nfind <- function(dat, zips, zip, radius, check) {\n  \n  # Check user input\n  # Need to check if proper zip code input by user\n  if(nchar(zip) > 5 | nchar(zip) < 5) {\n    stop(\"Please enter only a 5 digit zip code.\")\n  }\n  \n  # Read the registered practitioner working data\n  # Hidden so only read once when server started\n  #dat <- read.csv(\"data/tidy/workingDat.csv\", \n  #                colClasses = \"character\")\n  dat$latitude <- as.numeric(dat$latitude) # set long lat as numeric\n  dat$longitude <- as.numeric(dat$longitude)\n  dat$loc <- paste(dat$latitude, dat$longitude, sep=\":\")\n  \n  # Read the zip code data\n  # hidden because run once with server open\n  #zips <- read.csv(\"data/raw/free-zip-code-database.csv\", \n  #                 colClasses = \"character\") # zip code nees to be char\n  \n  zips$Latitude <- as.numeric(zips$Latitude) # set long lat as numeric\n  zips$Longitude <- as.numeric(zips$Longitude)\n  \n  # Subset the practitioner data for only lon/lat & index\n  datSub <- dat[,19:18]\n  \n  # Find the longitude/latitude of the user entered zip code\n  coordZip <- zips[zips$ZIPCode %in% zip,][6:5]\n  \n  # distant matrix distance between datSub and user inputted zip)  \n  dist <- rdist.earth(datSub, coordZip)\n  \n  # which of the distances are less than the radius\n  index <- which(dist < radius)\n  datFind <- dat[index, ]\n  \n  # If the data frame is empty return an error saying none found\n  if(nrow(datFind) == 0) {\n    stop(\"No patent agents found in the area specified\")\n  }\n  \n  # Also subset by input search of Attorney/Agent/Both\n  if(length(check) == 2) {\n    datFind <- datFind[,-1]\n    return(datFind)\n  } else {\n    datFind <- datFind[datFind$classification==check, ]\n    return(datFind)\n  }\n}",
    "created" : 1407815346915.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1718795861",
    "id" : "D74FBAC2",
    "lastKnownWriteTime" : 1407908699,
    "path" : "~/projects/dataDevProj/scripts/find.R",
    "project_path" : "scripts/find.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}